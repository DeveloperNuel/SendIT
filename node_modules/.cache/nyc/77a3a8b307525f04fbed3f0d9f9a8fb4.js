'use strict';var cov_vcspnr813=function(){var path="/home/emmanuel/Projects/SelfProject/sendit/src/routes/parcels.js",hash="9d9dac2f73587a9ffb0a6db445f99c03a8ccafda",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/emmanuel/Projects/SelfProject/sendit/src/routes/parcels.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:7,column:15},end:{line:7,column:33}},"2":{start:{line:9,column:16},end:{line:9,column:48}},"3":{start:{line:11,column:15},end:{line:11,column:41}},"4":{start:{line:13,column:16},end:{line:13,column:48}},"5":{start:{line:15,column:13},end:{line:15,column:37}},"6":{start:{line:17,column:14},end:{line:17,column:44}},"7":{start:{line:19,column:39},end:{line:19,column:93}},"8":{start:{line:21,column:13},end:{line:21,column:39}},"9":{start:{line:24,column:0},end:{line:77,column:3}},"10":{start:{line:25,column:18},end:{line:25,column:26}},"11":{start:{line:26,column:15},end:{line:26,column:31}},"12":{start:{line:27,column:15},end:{line:27,column:31}},"13":{start:{line:29,column:20},end:{line:29,column:22}},"14":{start:{line:30,column:21},end:{line:30,column:23}},"15":{start:{line:31,column:34},end:{line:31,column:38}},"16":{start:{line:33,column:13},end:{line:33,column:116}},"17":{start:{line:36,column:14},end:{line:36,column:20}},"18":{start:{line:38,column:13},end:{line:40,column:7}},"19":{start:{line:39,column:4},end:{line:39,column:38}},"20":{start:{line:42,column:23},end:{line:49,column:3}},"21":{start:{line:44,column:4},end:{line:46,column:5}},"22":{start:{line:45,column:6},end:{line:45,column:65}},"23":{start:{line:48,column:4},end:{line:48,column:98}},"24":{start:{line:51,column:2},end:{line:71,column:3}},"25":{start:{line:54,column:4},end:{line:54,column:99}},"26":{start:{line:56,column:14},end:{line:56,column:42}},"27":{start:{line:57,column:21},end:{line:57,column:27}},"28":{start:{line:58,column:4},end:{line:58,column:30}},"29":{start:{line:59,column:4},end:{line:59,column:34}},"30":{start:{line:62,column:4},end:{line:62,column:81}},"31":{start:{line:64,column:4},end:{line:64,column:35}},"32":{start:{line:65,column:4},end:{line:70,column:7}},"33":{start:{line:73,column:2},end:{line:76,column:5}},"34":{start:{line:80,column:0},end:{line:91,column:3}},"35":{start:{line:81,column:25},end:{line:81,column:27}},"36":{start:{line:82,column:2},end:{line:82,column:33}},"37":{start:{line:83,column:2},end:{line:85,column:5}},"38":{start:{line:84,column:4},end:{line:84,column:48}},"39":{start:{line:86,column:2},end:{line:90,column:5}},"40":{start:{line:94,column:0},end:{line:110,column:3}},"41":{start:{line:95,column:23},end:{line:97,column:4}},"42":{start:{line:96,column:4},end:{line:96,column:66}},"43":{start:{line:99,column:2},end:{line:105,column:3}},"44":{start:{line:100,column:4},end:{line:104,column:7}},"45":{start:{line:106,column:2},end:{line:109,column:5}},"46":{start:{line:113,column:0},end:{line:154,column:3}},"47":{start:{line:115,column:14},end:{line:115,column:20}},"48":{start:{line:116,column:2},end:{line:116,column:52}},"49":{start:{line:118,column:22},end:{line:120,column:4}},"50":{start:{line:119,column:4},end:{line:119,column:48}},"51":{start:{line:129,column:2},end:{line:149,column:3}},"52":{start:{line:130,column:4},end:{line:144,column:5}},"53":{start:{line:131,column:6},end:{line:131,column:40}},"54":{start:{line:132,column:6},end:{line:139,column:7}},"55":{start:{line:133,column:8},end:{line:133,column:60}},"56":{start:{line:134,column:8},end:{line:138,column:11}},"57":{start:{line:140,column:6},end:{line:143,column:9}},"58":{start:{line:145,column:4},end:{line:148,column:7}},"59":{start:{line:150,column:2},end:{line:153,column:5}},"60":{start:{line:156,column:0},end:{line:156,column:25}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:19,column:9},end:{line:19,column:31}},loc:{start:{line:19,column:37},end:{line:19,column:95}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:17},end:{line:24,column:18}},loc:{start:{line:24,column:37},end:{line:77,column:1}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:38,column:36},end:{line:38,column:37}},loc:{start:{line:38,column:56},end:{line:40,column:3}},line:38},"3":{name:"calculatePrice",decl:{start:{line:42,column:32},end:{line:42,column:46}},loc:{start:{line:42,column:66},end:{line:49,column:3}},line:42},"4":{name:"(anonymous_4)",decl:{start:{line:80,column:16},end:{line:80,column:17}},loc:{start:{line:80,column:36},end:{line:91,column:1}},line:80},"5":{name:"(anonymous_5)",decl:{start:{line:83,column:24},end:{line:83,column:25}},loc:{start:{line:83,column:42},end:{line:85,column:3}},line:83},"6":{name:"(anonymous_6)",decl:{start:{line:94,column:25},end:{line:94,column:26}},loc:{start:{line:94,column:45},end:{line:110,column:1}},line:94},"7":{name:"(anonymous_7)",decl:{start:{line:95,column:48},end:{line:95,column:49}},loc:{start:{line:95,column:66},end:{line:97,column:3}},line:95},"8":{name:"(anonymous_8)",decl:{start:{line:113,column:32},end:{line:113,column:33}},loc:{start:{line:113,column:52},end:{line:154,column:1}},line:113},"9":{name:"(anonymous_9)",decl:{start:{line:118,column:45},end:{line:118,column:46}},loc:{start:{line:118,column:61},end:{line:120,column:3}},line:118}},branchMap:{"0":{loc:{start:{line:19,column:46},end:{line:19,column:92}},type:"cond-expr",locations:[{start:{line:19,column:70},end:{line:19,column:73}},{start:{line:19,column:76},end:{line:19,column:92}}],line:19},"1":{loc:{start:{line:19,column:46},end:{line:19,column:67}},type:"binary-expr",locations:[{start:{line:19,column:46},end:{line:19,column:49}},{start:{line:19,column:53},end:{line:19,column:67}}],line:19},"2":{loc:{start:{line:44,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:46,column:5}},{start:{line:44,column:4},end:{line:46,column:5}}],line:44},"3":{loc:{start:{line:51,column:2},end:{line:71,column:3}},type:"if",locations:[{start:{line:51,column:2},end:{line:71,column:3}},{start:{line:51,column:2},end:{line:71,column:3}}],line:51},"4":{loc:{start:{line:54,column:12},end:{line:54,column:98}},type:"cond-expr",locations:[{start:{line:54,column:40},end:{line:54,column:67}},{start:{line:54,column:70},end:{line:54,column:98}}],line:54},"5":{loc:{start:{line:99,column:2},end:{line:105,column:3}},type:"if",locations:[{start:{line:99,column:2},end:{line:105,column:3}},{start:{line:99,column:2},end:{line:105,column:3}}],line:99},"6":{loc:{start:{line:129,column:2},end:{line:149,column:3}},type:"if",locations:[{start:{line:129,column:2},end:{line:149,column:3}},{start:{line:129,column:2},end:{line:149,column:3}}],line:129},"7":{loc:{start:{line:130,column:4},end:{line:144,column:5}},type:"if",locations:[{start:{line:130,column:4},end:{line:144,column:5}},{start:{line:130,column:4},end:{line:144,column:5}}],line:130},"8":{loc:{start:{line:130,column:8},end:{line:130,column:81}},type:"binary-expr",locations:[{start:{line:130,column:8},end:{line:130,column:42}},{start:{line:130,column:46},end:{line:130,column:81}}],line:130},"9":{loc:{start:{line:132,column:6},end:{line:139,column:7}},type:"if",locations:[{start:{line:132,column:6},end:{line:139,column:7}},{start:{line:132,column:6},end:{line:139,column:7}}],line:132}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_vcspnr813.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});var _express=(cov_vcspnr813.s[1]++,require('express'));var _express2=(cov_vcspnr813.s[2]++,_interopRequireDefault(_express));var _parcels=(cov_vcspnr813.s[3]++,require('../data/parcels'));var _parcels2=(cov_vcspnr813.s[4]++,_interopRequireDefault(_parcels));var _users=(cov_vcspnr813.s[5]++,require('../data/users'));var _users2=(cov_vcspnr813.s[6]++,_interopRequireDefault(_users));function _interopRequireDefault(obj){cov_vcspnr813.f[0]++;cov_vcspnr813.s[7]++;return(cov_vcspnr813.b[1][0]++,obj)&&(cov_vcspnr813.b[1][1]++,obj.__esModule)?(cov_vcspnr813.b[0][0]++,obj):(cov_vcspnr813.b[0][1]++,{default:obj});}var router=(cov_vcspnr813.s[8]++,_express2.default.Router());// Create parcel
cov_vcspnr813.s[9]++;router.post('/',function(req,res){cov_vcspnr813.f[1]++;var _req$body=(cov_vcspnr813.s[10]++,req.body),userId=(cov_vcspnr813.s[11]++,_req$body.userId),parcel=(cov_vcspnr813.s[12]++,_req$body.parcel);var priceNormal=(cov_vcspnr813.s[13]++,20);// Price in $
var priceExpress=(cov_vcspnr813.s[14]++,70);var priceIsForParcelAreaLimit=(cov_vcspnr813.s[15]++,2706);// Area is in cm
// area of a parcel
var area=(cov_vcspnr813.s[16]++,parcel.height*parcel.length*2+parcel.width*parcel.height*2+parcel.length*parcel.width*2);// Parcel price in $
var price=(cov_vcspnr813.s[17]++,void 0);var user=(cov_vcspnr813.s[18]++,_users2.default.filter(function(customer){cov_vcspnr813.f[2]++;cov_vcspnr813.s[19]++;return customer.userId===userId;})[0]);cov_vcspnr813.s[20]++;var calculatePrice=function calculatePrice(pricePerOneWeight){cov_vcspnr813.f[3]++;cov_vcspnr813.s[21]++;// Parcel area is not exceed
if(area<=priceIsForParcelAreaLimit){cov_vcspnr813.b[2][0]++;cov_vcspnr813.s[22]++;return pricePerOneWeight*parcel.weight*parcel.quantity;}else{cov_vcspnr813.b[2][1]++;}// Parcel area exceed
cov_vcspnr813.s[23]++;return pricePerOneWeight*parcel.weight*parcel.quantity*area/priceIsForParcelAreaLimit;};cov_vcspnr813.s[24]++;if(user){cov_vcspnr813.b[3][0]++;cov_vcspnr813.s[25]++;// Price per Service on Normal
// Price per Service on Express
price=parcel.From===parcel.To?(cov_vcspnr813.b[4][0]++,calculatePrice(priceNormal)):(cov_vcspnr813.b[4][1]++,calculatePrice(priceExpress));// Parcel Id
var pId=(cov_vcspnr813.s[26]++,_parcels2.default.length+1);var parcelWith=(cov_vcspnr813.s[27]++,parcel);cov_vcspnr813.s[28]++;parcelWith.parcelId=pId;cov_vcspnr813.s[29]++;parcelWith.status='booking';// Save parcel
cov_vcspnr813.s[30]++;_parcels2.default.push({userId:userId,price:price,parcel:parcelWith});cov_vcspnr813.s[31]++;console.log(_parcels2.default);cov_vcspnr813.s[32]++;return res.status(201).json({success:true,message:'Parcel created successfully',parcelId:pId,price:Number(price.toFixed(2))});}else{cov_vcspnr813.b[3][1]++;}cov_vcspnr813.s[33]++;return res.status(404).json({success:false,message:'User not Exist'});});// Get all parcels
cov_vcspnr813.s[34]++;router.get('/',function(req,res){cov_vcspnr813.f[4]++;var parcelDeliveries=(cov_vcspnr813.s[35]++,[]);cov_vcspnr813.s[36]++;console.log(_parcels2.default);cov_vcspnr813.s[37]++;_parcels2.default.map(function(parcel){cov_vcspnr813.f[5]++;cov_vcspnr813.s[38]++;return parcelDeliveries.push(parcel.parcel);});cov_vcspnr813.s[39]++;res.status(200).json({success:true,message:'Parcels retrieved successfully',parcels:parcelDeliveries});});// Get a specific parcels
cov_vcspnr813.s[40]++;router.get('/:parcelId',function(req,res){cov_vcspnr813.f[6]++;var parcelDelivery=(cov_vcspnr813.s[41]++,_parcels2.default.filter(function(parcel){cov_vcspnr813.f[7]++;cov_vcspnr813.s[42]++;return parcel.parcel.parcelId===Number(req.params.parcelId);}));cov_vcspnr813.s[43]++;if(parcelDelivery.length>0){cov_vcspnr813.b[5][0]++;cov_vcspnr813.s[44]++;return res.status(200).json({success:true,message:'Parcel of id '+req.params.parcelId+' retrieved successfully',parcel:parcelDelivery[0]});}else{cov_vcspnr813.b[5][1]++;}cov_vcspnr813.s[45]++;return res.status(404).json({success:false,message:'Parcel of id '+req.params.parcelId+' does not exist'});});// Cancel a parcel delivery order
cov_vcspnr813.s[46]++;router.put('/:parcelId/cancel',function(req,res){cov_vcspnr813.f[8]++;// let parcelDelivery = {};
var index=(cov_vcspnr813.s[47]++,void 0);cov_vcspnr813.s[48]++;req.params.parcelId=Number(req.params.parcelId);var currentParcel=(cov_vcspnr813.s[49]++,_parcels2.default.find(function(item){cov_vcspnr813.f[9]++;cov_vcspnr813.s[50]++;return item.parcelId===req.param.parcelId;}));/* for (let i = 0; i < Parcels.length; i += 1) {
    if (Parcels[i].parcel.parcelId === req.params.parcelId) {
      parcelDelivery = Parcels[i].parcel;
      index = i;
      break;
    }
  } */cov_vcspnr813.s[51]++;if(currentParcel){cov_vcspnr813.b[6][0]++;cov_vcspnr813.s[52]++;if((cov_vcspnr813.b[8][0]++,currentParcel.status==='pending')||(cov_vcspnr813.b[8][1]++,currentParcel.status==='canceled')){cov_vcspnr813.b[7][0]++;cov_vcspnr813.s[53]++;currentParcel.status='canceled';cov_vcspnr813.s[54]++;if(_parcels2.default[index].parcel.parcelId===currentParcel.parcelId){cov_vcspnr813.b[9][0]++;cov_vcspnr813.s[55]++;_parcels2.default[index].parcel.status='canceled';cov_vcspnr813.s[56]++;return res.status(200).send({success:true,message:'Parcel is successfully canceled',parcel:currentParcel});}else{cov_vcspnr813.b[9][1]++;}cov_vcspnr813.s[57]++;return res.status(405).send({success:false,message:'Data index changed. Try again!'});}else{cov_vcspnr813.b[7][1]++;}cov_vcspnr813.s[58]++;return res.status(405).send({success:false,message:'Not allowed to cancel a parcel with status of delivered or transit'});}else{cov_vcspnr813.b[6][1]++;}cov_vcspnr813.s[59]++;return res.status(404).send({success:false,message:'Parcel not found'});});cov_vcspnr813.s[60]++;exports.default=router;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmNlbHMuanMiXSwibmFtZXMiOlsicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJyZXEiLCJyZXMiLCJib2R5IiwidXNlcklkIiwicGFyY2VsIiwicHJpY2VOb3JtYWwiLCJwcmljZUV4cHJlc3MiLCJwcmljZUlzRm9yUGFyY2VsQXJlYUxpbWl0IiwiYXJlYSIsImhlaWdodCIsImxlbmd0aCIsIndpZHRoIiwicHJpY2UiLCJ1c2VyIiwiVXNlciIsImZpbHRlciIsImN1c3RvbWVyIiwiY2FsY3VsYXRlUHJpY2UiLCJwcmljZVBlck9uZVdlaWdodCIsIndlaWdodCIsInF1YW50aXR5IiwiRnJvbSIsIlRvIiwicElkIiwiUGFyY2VscyIsInBhcmNlbFdpdGgiLCJwYXJjZWxJZCIsInN0YXR1cyIsInB1c2giLCJjb25zb2xlIiwibG9nIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiTnVtYmVyIiwidG9GaXhlZCIsImdldCIsInBhcmNlbERlbGl2ZXJpZXMiLCJtYXAiLCJwYXJjZWxzIiwicGFyY2VsRGVsaXZlcnkiLCJwYXJhbXMiLCJwdXQiLCJpbmRleCIsImN1cnJlbnRQYXJjZWwiLCJmaW5kIiwiaXRlbSIsInBhcmFtIiwic2VuZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQSxJQUFNQSxTQUFTQyxrQkFBUUMsTUFBUixFQUFmOztBQUVBO0FBQ0FGLE9BQU9HLElBQVAsQ0FBWSxHQUFaLEVBQWlCLFVBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQUEsa0JBQ0ZELElBQUlFLElBREY7QUFBQSxNQUNyQkMsTUFEcUIsYUFDckJBLE1BRHFCO0FBQUEsTUFDYkMsTUFEYSxhQUNiQSxNQURhOztBQUU3QixNQUFNQyxjQUFjLEVBQXBCLENBRjZCLENBRUw7QUFDeEIsTUFBTUMsZUFBZSxFQUFyQjtBQUNBLE1BQU1DLDRCQUE0QixJQUFsQyxDQUo2QixDQUlXO0FBQ3hDO0FBQ0EsTUFBTUMs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Q0FBUDtBQUtEO0FBQ0QsYUFBTzNDLElBQUkwQixNQUFKLENBQVcsR0FBWCxFQUFnQnFCLElBQWhCLENBQXFCO0FBQzFCaEIsaUJBQVMsS0FEaUI7QUFFMUJDLGlCQUFTO0FBRmlCLE9BQXJCLENBQVA7QUFJRDtBQUNELFdBQU9oQyxJQUFJMEIsTUFBSixDQUFXLEdBQVgsRUFBZ0JxQixJQUFoQixDQUFxQjtBQUMxQmhCLGVBQVMsS0FEaUI7QUFFMUJDLGVBQ0U7QUFId0IsS0FBckIsQ0FBUDtBQUtEO0FBQ0QsU0FBT2hDLElBQUkwQixNQUFKLENBQVcsR0FBWCxFQUFnQnFCLElBQWhCLENBQXFCO0FBQzFCaEIsYUFBUyxLQURpQjtBQUUxQkMsYUFBUztBQUZpQixHQUFyQixDQUFQO0FBSUQsQ0ExQ0Q7O2tCQTRDZXJDLE0iLCJmaWxlIjoicGFyY2Vscy5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9lbW1hbnVlbC9Qcm9qZWN0cy9TZWxmUHJvamVjdC9zZW5kaXQvc3JjL3JvdXRlcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IFBhcmNlbHMgZnJvbSAnLi4vZGF0YS9wYXJjZWxzJztcbmltcG9ydCBVc2VyIGZyb20gJy4uL2RhdGEvdXNlcnMnO1xuXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4vLyBDcmVhdGUgcGFyY2VsXG5yb3V0ZXIucG9zdCgnLycsIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCB7IHVzZXJJZCwgcGFyY2VsIH0gPSByZXEuYm9keTtcbiAgY29uc3QgcHJpY2VOb3JtYWwgPSAyMDsgLy8gUHJpY2UgaW4gJFxuICBjb25zdCBwcmljZUV4cHJlc3MgPSA3MDtcbiAgY29uc3QgcHJpY2VJc0ZvclBhcmNlbEFyZWFMaW1pdCA9IDI3MDY7IC8vIEFyZWEgaXMgaW4gY21cbiAgLy8gYXJlYSBvZiBhIHBhcmNlbFxuICBjb25zdCBhcmVhID0gcGFyY2VsLmhlaWdodCAqIHBhcmNlbC5sZW5ndGggKiAyICsgcGFyY2VsLndpZHRoICogcGFyY2VsLmhlaWdodCAqIDJcbiAgICArIHBhcmNlbC5sZW5ndGggKiBwYXJjZWwud2lkdGggKiAyO1xuXG4gIC8vIFBhcmNlbCBwcmljZSBpbiAkXG4gIGxldCBwcmljZTtcblxuICBjb25zdCB1c2VyID0gVXNlci5maWx0ZXIoY3VzdG9tZXIgPT4gY3VzdG9tZXIudXNlcklkID09PSB1c2VySWQpWzBdO1xuXG4gIGNvbnN0IGNhbGN1bGF0ZVByaWNlID0gKHByaWNlUGVyT25lV2VpZ2h0KSA9PiB7XG4gICAgLy8gUGFyY2VsIGFyZWEgaXMgbm90IGV4Y2VlZFxuICAgIGlmIChhcmVhIDw9IHByaWNlSXNGb3JQYXJjZWxBcmVhTGltaXQpIHtcbiAgICAgIHJldHVybiBwcmljZVBlck9uZVdlaWdodCAqIHBhcmNlbC53ZWlnaHQgKiBwYXJjZWwucXVhbnRpdHk7XG4gICAgfVxuICAgIC8vIFBhcmNlbCBhcmVhIGV4Y2VlZFxuICAgIHJldHVybiAoXG4gICAgICAocHJpY2VQZXJPbmVXZWlnaHQgKiBwYXJjZWwud2VpZ2h0ICogcGFyY2VsLnF1YW50aXR5ICogYXJlYSkgLyBwcmljZUlzRm9yUGFyY2VsQXJlYUxpbWl0XG4gICAgKTtcbiAgfTtcblxuICBpZiAodXNlcikge1xuICAgIC8vIFByaWNlIHBlciBTZXJ2aWNlIG9uIE5vcm1hbFxuICAgIC8vIFByaWNlIHBlciBTZXJ2aWNlIG9uIEV4cHJlc3NcbiAgICBwcmljZSA9IHBhcmNlbC5Gcm9tID09PSBwYXJjZWwuVG9cbiAgICAgID8gY2FsY3VsYXRlUHJpY2UocHJpY2VOb3JtYWwpXG4gICAgICA6IGNhbGN1bGF0ZVByaWNlKHByaWNlRXhwcmVzcyk7XG4gICAgLy8gUGFyY2VsIElkXG4gICAgY29uc3QgcElkID0gUGFyY2Vscy5sZW5ndGggKyAxO1xuICAgIGNvbnN0IHBhcmNlbFdpdGggPSBwYXJjZWw7XG4gICAgcGFyY2VsV2l0aC5wYXJjZWxJZCA9IHBJZDtcbiAgICBwYXJjZWxXaXRoLnN0YXR1cyA9ICdib29raW5nJztcblxuICAgIC8vIFNhdmUgcGFyY2VsXG4gICAgUGFyY2Vscy5wdXNoKHsgdXNlcklkLCBwcmljZSwgcGFyY2VsOiBwYXJjZWxXaXRoIH0pO1xuXG4gICAgY29uc29sZS5sb2coUGFyY2Vscyk7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnUGFyY2VsIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIHBhcmNlbElkOiBwSWQsXG4gICAgICBwcmljZTogTnVtYmVyKHByaWNlLnRvRml4ZWQoMikpLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICBtZXNzYWdlOiAnVXNlciBub3QgRXhpc3QnLFxuICB9KTtcbn0pO1xuXG4vLyBHZXQgYWxsIHBhcmNlbHNcbnJvdXRlci5nZXQoJy8nLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgcGFyY2VsRGVsaXZlcmllcyA9IFtdO1xuICBjb25zb2xlLmxvZyhQYXJjZWxzKTtcbiAgUGFyY2Vscy5tYXAocGFyY2VsID0+IHBhcmNlbERlbGl2ZXJpZXMucHVzaChwYXJjZWwucGFyY2VsKSk7XG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIG1lc3NhZ2U6ICdQYXJjZWxzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknLFxuICAgIHBhcmNlbHM6IHBhcmNlbERlbGl2ZXJpZXMsXG4gIH0pO1xufSk7XG5cbi8vIEdldCBhIHNwZWNpZmljIHBhcmNlbHNcbnJvdXRlci5nZXQoJy86cGFyY2VsSWQnLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgcGFyY2VsRGVsaXZlcnkgPSBQYXJjZWxzLmZpbHRlcihcbiAgICBwYXJjZWwgPT4gcGFyY2VsLnBhcmNlbC5wYXJjZWxJZCA9PT0gTnVtYmVyKHJlcS5wYXJhbXMucGFyY2VsSWQpLFxuICApO1xuXG4gIGlmIChwYXJjZWxEZWxpdmVyeS5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiBgUGFyY2VsIG9mIGlkICR7cmVxLnBhcmFtcy5wYXJjZWxJZH0gcmV0cmlldmVkIHN1Y2Nlc3NmdWxseWAsXG4gICAgICBwYXJjZWw6IHBhcmNlbERlbGl2ZXJ5WzBdLFxuICAgIH0pO1xuICB9XG4gIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgbWVzc2FnZTogYFBhcmNlbCBvZiBpZCAke3JlcS5wYXJhbXMucGFyY2VsSWR9IGRvZXMgbm90IGV4aXN0YCxcbiAgfSk7XG59KTtcblxuLy8gQ2FuY2VsIGEgcGFyY2VsIGRlbGl2ZXJ5IG9yZGVyXG5yb3V0ZXIucHV0KCcvOnBhcmNlbElkL2NhbmNlbCcsIChyZXEsIHJlcykgPT4ge1xuICAvLyBsZXQgcGFyY2VsRGVsaXZlcnkgPSB7fTtcbiAgbGV0IGluZGV4O1xuICByZXEucGFyYW1zLnBhcmNlbElkID0gTnVtYmVyKHJlcS5wYXJhbXMucGFyY2VsSWQpO1xuXG4gIGNvbnN0IGN1cnJlbnRQYXJjZWwgPSBQYXJjZWxzLmZpbmQoaXRlbSA9PiBpdGVtLnBhcmNlbElkID09PSByZXEucGFyYW0ucGFyY2VsSWQpO1xuICAvKiBmb3IgKGxldCBpID0gMDsgaSA8IFBhcmNlbHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBpZiAoUGFyY2Vsc1tpXS5wYXJjZWwucGFyY2VsSWQgPT09IHJlcS5wYXJhbXMucGFyY2VsSWQpIHtcbiAgICAgIHBhcmNlbERlbGl2ZXJ5ID0gUGFyY2Vsc1tpXS5wYXJjZWw7XG4gICAgICBpbmRleCA9IGk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH0gKi9cblxuICBpZiAoY3VycmVudFBhcmNlbCkge1xuICAgIGlmIChcbiAgICAgIGN1cnJlbnRQYXJjZWwuc3RhdHVzID09PSAncGVuZGluZycgfHwgY3VycmVudFBhcmNlbC5zdGF0dXMgPT09ICdjYW5jZWxlZCdcbiAgICApIHtcbiAgICAgIGN1cnJlbnRQYXJjZWwuc3RhdHVzID0gJ2NhbmNlbGVkJztcbiAgICAgIGlmIChQYXJjZWxzW2luZGV4XS5wYXJjZWwucGFyY2VsSWQgPT09IGN1cnJlbnRQYXJjZWwucGFyY2VsSWQpIHtcbiAgICAgICAgUGFyY2Vsc1tpbmRleF0ucGFyY2VsLnN0YXR1cyA9ICdjYW5jZWxlZCc7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiAnUGFyY2VsIGlzIHN1Y2Nlc3NmdWxseSBjYW5jZWxlZCcsXG4gICAgICAgICAgcGFyY2VsOiBjdXJyZW50UGFyY2VsLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuc2VuZCh7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRGF0YSBpbmRleCBjaGFuZ2VkLiBUcnkgYWdhaW4hJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLnNlbmQoe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOlxuICAgICAgICAnTm90IGFsbG93ZWQgdG8gY2FuY2VsIGEgcGFyY2VsIHdpdGggc3RhdHVzIG9mIGRlbGl2ZXJlZCBvciB0cmFuc2l0JyxcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoe1xuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIG1lc3NhZ2U6ICdQYXJjZWwgbm90IGZvdW5kJyxcbiAgfSk7XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xuIl19