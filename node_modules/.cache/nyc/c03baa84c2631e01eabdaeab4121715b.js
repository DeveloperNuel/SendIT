'use strict';var cov_vcspnr813=function(){var path="/home/emmanuel/Projects/SelfProject/sendit/src/routes/parcels.js",hash="fde791371abfa6511b95ee2dd548aeddddd81f68",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/emmanuel/Projects/SelfProject/sendit/src/routes/parcels.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:7,column:15},end:{line:7,column:33}},"2":{start:{line:9,column:16},end:{line:9,column:48}},"3":{start:{line:11,column:15},end:{line:11,column:41}},"4":{start:{line:13,column:16},end:{line:13,column:48}},"5":{start:{line:15,column:13},end:{line:15,column:37}},"6":{start:{line:17,column:14},end:{line:17,column:44}},"7":{start:{line:19,column:39},end:{line:19,column:93}},"8":{start:{line:21,column:13},end:{line:21,column:39}},"9":{start:{line:24,column:0},end:{line:77,column:3}},"10":{start:{line:25,column:18},end:{line:25,column:26}},"11":{start:{line:26,column:15},end:{line:26,column:31}},"12":{start:{line:27,column:15},end:{line:27,column:31}},"13":{start:{line:29,column:20},end:{line:29,column:22}},"14":{start:{line:30,column:21},end:{line:30,column:23}},"15":{start:{line:31,column:34},end:{line:31,column:38}},"16":{start:{line:33,column:13},end:{line:33,column:116}},"17":{start:{line:36,column:14},end:{line:36,column:20}},"18":{start:{line:38,column:13},end:{line:40,column:7}},"19":{start:{line:39,column:4},end:{line:39,column:38}},"20":{start:{line:42,column:23},end:{line:49,column:3}},"21":{start:{line:44,column:4},end:{line:46,column:5}},"22":{start:{line:45,column:6},end:{line:45,column:65}},"23":{start:{line:48,column:4},end:{line:48,column:98}},"24":{start:{line:51,column:2},end:{line:71,column:3}},"25":{start:{line:54,column:4},end:{line:54,column:99}},"26":{start:{line:56,column:14},end:{line:56,column:42}},"27":{start:{line:57,column:21},end:{line:57,column:27}},"28":{start:{line:58,column:4},end:{line:58,column:30}},"29":{start:{line:59,column:4},end:{line:59,column:34}},"30":{start:{line:62,column:4},end:{line:62,column:81}},"31":{start:{line:64,column:4},end:{line:64,column:35}},"32":{start:{line:65,column:4},end:{line:70,column:7}},"33":{start:{line:73,column:2},end:{line:76,column:5}},"34":{start:{line:80,column:0},end:{line:91,column:3}},"35":{start:{line:81,column:25},end:{line:81,column:27}},"36":{start:{line:82,column:2},end:{line:82,column:33}},"37":{start:{line:83,column:2},end:{line:85,column:5}},"38":{start:{line:84,column:4},end:{line:84,column:48}},"39":{start:{line:86,column:2},end:{line:90,column:5}},"40":{start:{line:94,column:0},end:{line:110,column:3}},"41":{start:{line:95,column:23},end:{line:97,column:4}},"42":{start:{line:96,column:4},end:{line:96,column:66}},"43":{start:{line:99,column:2},end:{line:105,column:3}},"44":{start:{line:100,column:4},end:{line:104,column:7}},"45":{start:{line:106,column:2},end:{line:109,column:5}},"46":{start:{line:113,column:0},end:{line:150,column:3}},"47":{start:{line:114,column:23},end:{line:114,column:25}},"48":{start:{line:115,column:14},end:{line:115,column:20}},"49":{start:{line:116,column:2},end:{line:116,column:52}},"50":{start:{line:117,column:2},end:{line:123,column:3}},"51":{start:{line:118,column:4},end:{line:122,column:5}},"52":{start:{line:119,column:6},end:{line:119,column:51}},"53":{start:{line:120,column:6},end:{line:120,column:16}},"54":{start:{line:121,column:6},end:{line:121,column:12}},"55":{start:{line:125,column:2},end:{line:145,column:3}},"56":{start:{line:126,column:4},end:{line:140,column:5}},"57":{start:{line:127,column:6},end:{line:127,column:41}},"58":{start:{line:128,column:6},end:{line:135,column:7}},"59":{start:{line:129,column:8},end:{line:129,column:60}},"60":{start:{line:130,column:8},end:{line:134,column:11}},"61":{start:{line:136,column:6},end:{line:139,column:9}},"62":{start:{line:141,column:4},end:{line:144,column:7}},"63":{start:{line:146,column:2},end:{line:149,column:5}},"64":{start:{line:152,column:0},end:{line:152,column:25}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:19,column:9},end:{line:19,column:31}},loc:{start:{line:19,column:37},end:{line:19,column:95}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:17},end:{line:24,column:18}},loc:{start:{line:24,column:37},end:{line:77,column:1}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:38,column:36},end:{line:38,column:37}},loc:{start:{line:38,column:56},end:{line:40,column:3}},line:38},"3":{name:"calculatePrice",decl:{start:{line:42,column:32},end:{line:42,column:46}},loc:{start:{line:42,column:66},end:{line:49,column:3}},line:42},"4":{name:"(anonymous_4)",decl:{start:{line:80,column:16},end:{line:80,column:17}},loc:{start:{line:80,column:36},end:{line:91,column:1}},line:80},"5":{name:"(anonymous_5)",decl:{start:{line:83,column:24},end:{line:83,column:25}},loc:{start:{line:83,column:42},end:{line:85,column:3}},line:83},"6":{name:"(anonymous_6)",decl:{start:{line:94,column:25},end:{line:94,column:26}},loc:{start:{line:94,column:45},end:{line:110,column:1}},line:94},"7":{name:"(anonymous_7)",decl:{start:{line:95,column:48},end:{line:95,column:49}},loc:{start:{line:95,column:66},end:{line:97,column:3}},line:95},"8":{name:"(anonymous_8)",decl:{start:{line:113,column:32},end:{line:113,column:33}},loc:{start:{line:113,column:52},end:{line:150,column:1}},line:113}},branchMap:{"0":{loc:{start:{line:19,column:46},end:{line:19,column:92}},type:"cond-expr",locations:[{start:{line:19,column:70},end:{line:19,column:73}},{start:{line:19,column:76},end:{line:19,column:92}}],line:19},"1":{loc:{start:{line:19,column:46},end:{line:19,column:67}},type:"binary-expr",locations:[{start:{line:19,column:46},end:{line:19,column:49}},{start:{line:19,column:53},end:{line:19,column:67}}],line:19},"2":{loc:{start:{line:44,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:46,column:5}},{start:{line:44,column:4},end:{line:46,column:5}}],line:44},"3":{loc:{start:{line:51,column:2},end:{line:71,column:3}},type:"if",locations:[{start:{line:51,column:2},end:{line:71,column:3}},{start:{line:51,column:2},end:{line:71,column:3}}],line:51},"4":{loc:{start:{line:54,column:12},end:{line:54,column:98}},type:"cond-expr",locations:[{start:{line:54,column:40},end:{line:54,column:67}},{start:{line:54,column:70},end:{line:54,column:98}}],line:54},"5":{loc:{start:{line:99,column:2},end:{line:105,column:3}},type:"if",locations:[{start:{line:99,column:2},end:{line:105,column:3}},{start:{line:99,column:2},end:{line:105,column:3}}],line:99},"6":{loc:{start:{line:118,column:4},end:{line:122,column:5}},type:"if",locations:[{start:{line:118,column:4},end:{line:122,column:5}},{start:{line:118,column:4},end:{line:122,column:5}}],line:118},"7":{loc:{start:{line:125,column:2},end:{line:145,column:3}},type:"if",locations:[{start:{line:125,column:2},end:{line:145,column:3}},{start:{line:125,column:2},end:{line:145,column:3}}],line:125},"8":{loc:{start:{line:126,column:4},end:{line:140,column:5}},type:"if",locations:[{start:{line:126,column:4},end:{line:140,column:5}},{start:{line:126,column:4},end:{line:140,column:5}}],line:126},"9":{loc:{start:{line:126,column:8},end:{line:126,column:83}},type:"binary-expr",locations:[{start:{line:126,column:8},end:{line:126,column:43}},{start:{line:126,column:47},end:{line:126,column:83}}],line:126},"10":{loc:{start:{line:128,column:6},end:{line:135,column:7}},type:"if",locations:[{start:{line:128,column:6},end:{line:135,column:7}},{start:{line:128,column:6},end:{line:135,column:7}}],line:128}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_vcspnr813.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});var _express=(cov_vcspnr813.s[1]++,require('express'));var _express2=(cov_vcspnr813.s[2]++,_interopRequireDefault(_express));var _parcels=(cov_vcspnr813.s[3]++,require('../data/parcels'));var _parcels2=(cov_vcspnr813.s[4]++,_interopRequireDefault(_parcels));var _users=(cov_vcspnr813.s[5]++,require('../data/users'));var _users2=(cov_vcspnr813.s[6]++,_interopRequireDefault(_users));function _interopRequireDefault(obj){cov_vcspnr813.f[0]++;cov_vcspnr813.s[7]++;return(cov_vcspnr813.b[1][0]++,obj)&&(cov_vcspnr813.b[1][1]++,obj.__esModule)?(cov_vcspnr813.b[0][0]++,obj):(cov_vcspnr813.b[0][1]++,{default:obj});}var router=(cov_vcspnr813.s[8]++,_express2.default.Router());// Create parcel
cov_vcspnr813.s[9]++;router.post('/',function(req,res){cov_vcspnr813.f[1]++;var _req$body=(cov_vcspnr813.s[10]++,req.body),userId=(cov_vcspnr813.s[11]++,_req$body.userId),parcel=(cov_vcspnr813.s[12]++,_req$body.parcel);var priceNormal=(cov_vcspnr813.s[13]++,20);// Price in $
var priceExpress=(cov_vcspnr813.s[14]++,70);var priceIsForParcelAreaLimit=(cov_vcspnr813.s[15]++,2706);// Area is in cm
// area of a parcel
var area=(cov_vcspnr813.s[16]++,parcel.height*parcel.length*2+parcel.width*parcel.height*2+parcel.length*parcel.width*2);// Parcel price in $
var price=(cov_vcspnr813.s[17]++,void 0);var user=(cov_vcspnr813.s[18]++,_users2.default.filter(function(customer){cov_vcspnr813.f[2]++;cov_vcspnr813.s[19]++;return customer.userId===userId;})[0]);cov_vcspnr813.s[20]++;var calculatePrice=function calculatePrice(pricePerOneWeight){cov_vcspnr813.f[3]++;cov_vcspnr813.s[21]++;// Parcel area is not exceed
if(area<=priceIsForParcelAreaLimit){cov_vcspnr813.b[2][0]++;cov_vcspnr813.s[22]++;return pricePerOneWeight*parcel.weight*parcel.quantity;}else{cov_vcspnr813.b[2][1]++;}// Parcel area exceed
cov_vcspnr813.s[23]++;return pricePerOneWeight*parcel.weight*parcel.quantity*area/priceIsForParcelAreaLimit;};cov_vcspnr813.s[24]++;if(user){cov_vcspnr813.b[3][0]++;cov_vcspnr813.s[25]++;// Price per Service on Normal
// Price per Service on Express
price=parcel.From===parcel.To?(cov_vcspnr813.b[4][0]++,calculatePrice(priceNormal)):(cov_vcspnr813.b[4][1]++,calculatePrice(priceExpress));// Parcel Id
var pId=(cov_vcspnr813.s[26]++,_parcels2.default.length+1);var parcelWith=(cov_vcspnr813.s[27]++,parcel);cov_vcspnr813.s[28]++;parcelWith.parcelId=pId;cov_vcspnr813.s[29]++;parcelWith.status='booking';// Save parcel
cov_vcspnr813.s[30]++;_parcels2.default.push({userId:userId,price:price,parcel:parcelWith});cov_vcspnr813.s[31]++;console.log(_parcels2.default);cov_vcspnr813.s[32]++;return res.status(201).json({success:true,message:'Parcel created successfully',parcelId:pId,price:Number(price.toFixed(2))});}else{cov_vcspnr813.b[3][1]++;}cov_vcspnr813.s[33]++;return res.status(404).json({success:false,message:'User not Exist'});});// Get all parcels
cov_vcspnr813.s[34]++;router.get('/',function(req,res){cov_vcspnr813.f[4]++;var parcelDeliveries=(cov_vcspnr813.s[35]++,[]);cov_vcspnr813.s[36]++;console.log(_parcels2.default);cov_vcspnr813.s[37]++;_parcels2.default.map(function(parcel){cov_vcspnr813.f[5]++;cov_vcspnr813.s[38]++;return parcelDeliveries.push(parcel.parcel);});cov_vcspnr813.s[39]++;res.status(200).json({success:true,message:'Parcels retrieved successfully',parcels:parcelDeliveries});});// Get a specific parcels
cov_vcspnr813.s[40]++;router.get('/:parcelId',function(req,res){cov_vcspnr813.f[6]++;var parcelDelivery=(cov_vcspnr813.s[41]++,_parcels2.default.filter(function(parcel){cov_vcspnr813.f[7]++;cov_vcspnr813.s[42]++;return parcel.parcel.parcelId===Number(req.params.parcelId);}));cov_vcspnr813.s[43]++;if(parcelDelivery.length>0){cov_vcspnr813.b[5][0]++;cov_vcspnr813.s[44]++;return res.status(200).json({success:true,message:'Parcel of id '+req.params.parcelId+' retrieved successfully',parcel:parcelDelivery[0]});}else{cov_vcspnr813.b[5][1]++;}cov_vcspnr813.s[45]++;return res.status(404).json({success:false,message:'Parcel of id '+req.params.parcelId+' does not exist'});});// Cancel a parcel delivery order
cov_vcspnr813.s[46]++;router.put('/:parcelId/cancel',function(req,res){cov_vcspnr813.f[8]++;var parcelDelivery=(cov_vcspnr813.s[47]++,{});var index=(cov_vcspnr813.s[48]++,void 0);cov_vcspnr813.s[49]++;req.params.parcelId=Number(req.params.parcelId);cov_vcspnr813.s[50]++;for(var i=0;i<_parcels2.default.length;i+=1){cov_vcspnr813.s[51]++;if(_parcels2.default[i].parcel.parcelId===req.params.parcelId){cov_vcspnr813.b[6][0]++;cov_vcspnr813.s[52]++;parcelDelivery=_parcels2.default[i].parcel;cov_vcspnr813.s[53]++;index=i;cov_vcspnr813.s[54]++;break;}else{cov_vcspnr813.b[6][1]++;}}cov_vcspnr813.s[55]++;if(parcelDelivery){cov_vcspnr813.b[7][0]++;cov_vcspnr813.s[56]++;if((cov_vcspnr813.b[9][0]++,parcelDelivery.status==='pending')||(cov_vcspnr813.b[9][1]++,parcelDelivery.status==='canceled')){cov_vcspnr813.b[8][0]++;cov_vcspnr813.s[57]++;parcelDelivery.status='canceled';cov_vcspnr813.s[58]++;if(_parcels2.default[index].parcel.parcelId===parcelDelivery.parcelId){cov_vcspnr813.b[10][0]++;cov_vcspnr813.s[59]++;_parcels2.default[index].parcel.status='canceled';cov_vcspnr813.s[60]++;return res.status(200).send({success:true,message:'Parcel is successfully canceled',parcel:parcelDelivery});}else{cov_vcspnr813.b[10][1]++;}cov_vcspnr813.s[61]++;return res.status(405).send({success:false,message:'Data index changed. Try again!'});}else{cov_vcspnr813.b[8][1]++;}cov_vcspnr813.s[62]++;return res.status(405).send({success:false,message:'Not allowed to cancel a parcel with status of delivered or transit'});}else{cov_vcspnr813.b[7][1]++;}cov_vcspnr813.s[63]++;return res.status(404).send({success:false,message:'Parcel not found'});});cov_vcspnr813.s[64]++;exports.default=router;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmNlbHMuanMiXSwibmFtZXMiOlsicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJyZXEiLCJyZXMiLCJib2R5IiwidXNlcklkIiwicGFyY2VsIiwicHJpY2VOb3JtYWwiLCJwcmljZUV4cHJlc3MiLCJwcmljZUlzRm9yUGFyY2VsQXJlYUxpbWl0IiwiYXJlYSIsImhlaWdodCIsImxlbmd0aCIsIndpZHRoIiwicHJpY2UiLCJ1c2VyIiwiVXNlciIsImZpbHRlciIsImN1c3RvbWVyIiwiY2FsY3VsYXRlUHJpY2UiLCJwcmljZVBlck9uZVdlaWdodCIsIndlaWdodCIsInF1YW50aXR5IiwiRnJvbSIsIlRvIiwicElkIiwiUGFyY2VscyIsInBhcmNlbFdpdGgiLCJwYXJjZWxJZCIsInN0YXR1cyIsInB1c2giLCJjb25zb2xlIiwibG9nIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiTnVtYmVyIiwidG9GaXhlZCIsImdldCIsInBhcmNlbERlbGl2ZXJpZXMiLCJtYXAiLCJwYXJjZWxzIiwicGFyY2VsRGVsaXZlcnkiLCJwYXJhbXMiLCJwdXQiLCJpbmRleCIsImkiLCJzZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVBLElBQU1BLFNBQVNDLGtCQUFRQyxNQUFSLEVBQWY7O0FBRUE7QUFDQUYsT0FBT0csSUFBUCxDQUFZLEdBQVosRUFBaUIsVUFBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQWM7QUFBQSxrQkFDRkQsSUFBSUUsSUFERjtBQUFBLE1BQ3JCQyxNQURxQixhQUNyQkEsTUFEcUI7QUFBQSxNQUNiQyxNQURhLGFBQ2JBLE1BRGE7O0FBRTdCLE1BQU1DLGNBQWMsRUFBcEIsQ0FGNkIsQ0FFTDtBQUN4QixNQUFNQyxlQUFlLEVBQXJCO0FBQ0EsTUFBTUMsNEJBQTRCLElBQWxDLENBSjZCLENBSVc7QUFDeEM7QUFDQSxNQUFNQyxPQUFPSixPQUFPSyxNQUFQLEdBQWdCTCxPQUFPTSxNQUF2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Q0FBVyxHQUFYLEVBQWdCa0IsSUFBaEIsQ0FBcUI7QUFDMUJiLG1CQUFTLElBRGlCO0FBRTFCQyxtQkFBUyxpQ0FGaUI7QUFHMUI3QixrQkFBUW9DO0FBSGtCLFNBQXJCLENBQVA7QUFLRDtBQUNELGFBQU92QyxJQUFJMEIsTUFBSixDQUFXLEdBQVgsRUFBZ0JrQixJQUFoQixDQUFxQjtBQUMxQmIsaUJBQVMsS0FEaUI7QUFFMUJDLGlCQUFTO0FBRmlCLE9BQXJCLENBQVA7QUFJRDtBQUNELFdBQU9oQyxJQUFJMEIsTUFBSixDQUFXLEdBQVgsRUFBZ0JrQixJQUFoQixDQUFxQjtBQUMxQmIsZUFBUyxLQURpQjtBQUUxQkMsZUFDRTtBQUh3QixLQUFyQixDQUFQO0FBS0Q7QUFDRCxTQUFPaEMsSUFBSTBCLE1BQUosQ0FBVyxHQUFYLEVBQWdCa0IsSUFBaEIsQ0FBcUI7QUFDMUJiLGFBQVMsS0FEaUI7QUFFMUJDLGFBQVM7QUFGaUIsR0FBckIsQ0FBUDtBQUlELENBeENEOztrQkEwQ2VyQyxNIiwiZmlsZSI6InBhcmNlbHMuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvZW1tYW51ZWwvUHJvamVjdHMvU2VsZlByb2plY3Qvc2VuZGl0L3NyYy9yb3V0ZXMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBQYXJjZWxzIGZyb20gJy4uL2RhdGEvcGFyY2Vscyc7XG5pbXBvcnQgVXNlciBmcm9tICcuLi9kYXRhL3VzZXJzJztcblxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuLy8gQ3JlYXRlIHBhcmNlbFxucm91dGVyLnBvc3QoJy8nLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgeyB1c2VySWQsIHBhcmNlbCB9ID0gcmVxLmJvZHk7XG4gIGNvbnN0IHByaWNlTm9ybWFsID0gMjA7IC8vIFByaWNlIGluICRcbiAgY29uc3QgcHJpY2VFeHByZXNzID0gNzA7XG4gIGNvbnN0IHByaWNlSXNGb3JQYXJjZWxBcmVhTGltaXQgPSAyNzA2OyAvLyBBcmVhIGlzIGluIGNtXG4gIC8vIGFyZWEgb2YgYSBwYXJjZWxcbiAgY29uc3QgYXJlYSA9IHBhcmNlbC5oZWlnaHQgKiBwYXJjZWwubGVuZ3RoICogMiArIHBhcmNlbC53aWR0aCAqIHBhcmNlbC5oZWlnaHQgKiAyXG4gICAgKyBwYXJjZWwubGVuZ3RoICogcGFyY2VsLndpZHRoICogMjtcblxuICAvLyBQYXJjZWwgcHJpY2UgaW4gJFxuICBsZXQgcHJpY2U7XG5cbiAgY29uc3QgdXNlciA9IFVzZXIuZmlsdGVyKGN1c3RvbWVyID0+IGN1c3RvbWVyLnVzZXJJZCA9PT0gdXNlcklkKVswXTtcblxuICBjb25zdCBjYWxjdWxhdGVQcmljZSA9IChwcmljZVBlck9uZVdlaWdodCkgPT4ge1xuICAgIC8vIFBhcmNlbCBhcmVhIGlzIG5vdCBleGNlZWRcbiAgICBpZiAoYXJlYSA8PSBwcmljZUlzRm9yUGFyY2VsQXJlYUxpbWl0KSB7XG4gICAgICByZXR1cm4gcHJpY2VQZXJPbmVXZWlnaHQgKiBwYXJjZWwud2VpZ2h0ICogcGFyY2VsLnF1YW50aXR5O1xuICAgIH1cbiAgICAvLyBQYXJjZWwgYXJlYSBleGNlZWRcbiAgICByZXR1cm4gKFxuICAgICAgKHByaWNlUGVyT25lV2VpZ2h0ICogcGFyY2VsLndlaWdodCAqIHBhcmNlbC5xdWFudGl0eSAqIGFyZWEpIC8gcHJpY2VJc0ZvclBhcmNlbEFyZWFMaW1pdFxuICAgICk7XG4gIH07XG5cbiAgaWYgKHVzZXIpIHtcbiAgICAvLyBQcmljZSBwZXIgU2VydmljZSBvbiBOb3JtYWxcbiAgICAvLyBQcmljZSBwZXIgU2VydmljZSBvbiBFeHByZXNzXG4gICAgcHJpY2UgPSBwYXJjZWwuRnJvbSA9PT0gcGFyY2VsLlRvXG4gICAgICA/IGNhbGN1bGF0ZVByaWNlKHByaWNlTm9ybWFsKVxuICAgICAgOiBjYWxjdWxhdGVQcmljZShwcmljZUV4cHJlc3MpO1xuICAgIC8vIFBhcmNlbCBJZFxuICAgIGNvbnN0IHBJZCA9IFBhcmNlbHMubGVuZ3RoICsgMTtcbiAgICBjb25zdCBwYXJjZWxXaXRoID0gcGFyY2VsO1xuICAgIHBhcmNlbFdpdGgucGFyY2VsSWQgPSBwSWQ7XG4gICAgcGFyY2VsV2l0aC5zdGF0dXMgPSAnYm9va2luZyc7XG5cbiAgICAvLyBTYXZlIHBhcmNlbFxuICAgIFBhcmNlbHMucHVzaCh7IHVzZXJJZCwgcHJpY2UsIHBhcmNlbDogcGFyY2VsV2l0aCB9KTtcblxuICAgIGNvbnNvbGUubG9nKFBhcmNlbHMpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1BhcmNlbCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICBwYXJjZWxJZDogcElkLFxuICAgICAgcHJpY2U6IE51bWJlcihwcmljZS50b0ZpeGVkKDIpKSxcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgbWVzc2FnZTogJ1VzZXIgbm90IEV4aXN0JyxcbiAgfSk7XG59KTtcblxuLy8gR2V0IGFsbCBwYXJjZWxzXG5yb3V0ZXIuZ2V0KCcvJywgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHBhcmNlbERlbGl2ZXJpZXMgPSBbXTtcbiAgY29uc29sZS5sb2coUGFyY2Vscyk7XG4gIFBhcmNlbHMubWFwKHBhcmNlbCA9PiBwYXJjZWxEZWxpdmVyaWVzLnB1c2gocGFyY2VsLnBhcmNlbCkpO1xuICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBtZXNzYWdlOiAnUGFyY2VscyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICBwYXJjZWxzOiBwYXJjZWxEZWxpdmVyaWVzLFxuICB9KTtcbn0pO1xuXG4vLyBHZXQgYSBzcGVjaWZpYyBwYXJjZWxzXG5yb3V0ZXIuZ2V0KCcvOnBhcmNlbElkJywgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHBhcmNlbERlbGl2ZXJ5ID0gUGFyY2Vscy5maWx0ZXIoXG4gICAgcGFyY2VsID0+IHBhcmNlbC5wYXJjZWwucGFyY2VsSWQgPT09IE51bWJlcihyZXEucGFyYW1zLnBhcmNlbElkKSxcbiAgKTtcblxuICBpZiAocGFyY2VsRGVsaXZlcnkubGVuZ3RoID4gMCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogYFBhcmNlbCBvZiBpZCAke3JlcS5wYXJhbXMucGFyY2VsSWR9IHJldHJpZXZlZCBzdWNjZXNzZnVsbHlgLFxuICAgICAgcGFyY2VsOiBwYXJjZWxEZWxpdmVyeVswXSxcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIG1lc3NhZ2U6IGBQYXJjZWwgb2YgaWQgJHtyZXEucGFyYW1zLnBhcmNlbElkfSBkb2VzIG5vdCBleGlzdGAsXG4gIH0pO1xufSk7XG5cbi8vIENhbmNlbCBhIHBhcmNlbCBkZWxpdmVyeSBvcmRlclxucm91dGVyLnB1dCgnLzpwYXJjZWxJZC9jYW5jZWwnLCAocmVxLCByZXMpID0+IHtcbiAgbGV0IHBhcmNlbERlbGl2ZXJ5ID0ge307XG4gIGxldCBpbmRleDtcbiAgcmVxLnBhcmFtcy5wYXJjZWxJZCA9IE51bWJlcihyZXEucGFyYW1zLnBhcmNlbElkKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBQYXJjZWxzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgaWYgKFBhcmNlbHNbaV0ucGFyY2VsLnBhcmNlbElkID09PSByZXEucGFyYW1zLnBhcmNlbElkKSB7XG4gICAgICBwYXJjZWxEZWxpdmVyeSA9IFBhcmNlbHNbaV0ucGFyY2VsO1xuICAgICAgaW5kZXggPSBpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgaWYgKHBhcmNlbERlbGl2ZXJ5KSB7XG4gICAgaWYgKFxuICAgICAgcGFyY2VsRGVsaXZlcnkuc3RhdHVzID09PSAncGVuZGluZycgfHwgcGFyY2VsRGVsaXZlcnkuc3RhdHVzID09PSAnY2FuY2VsZWQnXG4gICAgKSB7XG4gICAgICBwYXJjZWxEZWxpdmVyeS5zdGF0dXMgPSAnY2FuY2VsZWQnO1xuICAgICAgaWYgKFBhcmNlbHNbaW5kZXhdLnBhcmNlbC5wYXJjZWxJZCA9PT0gcGFyY2VsRGVsaXZlcnkucGFyY2VsSWQpIHtcbiAgICAgICAgUGFyY2Vsc1tpbmRleF0ucGFyY2VsLnN0YXR1cyA9ICdjYW5jZWxlZCc7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiAnUGFyY2VsIGlzIHN1Y2Nlc3NmdWxseSBjYW5jZWxlZCcsXG4gICAgICAgICAgcGFyY2VsOiBwYXJjZWxEZWxpdmVyeSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLnNlbmQoe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0RhdGEgaW5kZXggY2hhbmdlZC4gVHJ5IGFnYWluIScsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5zZW5kKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTpcbiAgICAgICAgJ05vdCBhbGxvd2VkIHRvIGNhbmNlbCBhIHBhcmNlbCB3aXRoIHN0YXR1cyBvZiBkZWxpdmVyZWQgb3IgdHJhbnNpdCcsXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5zZW5kKHtcbiAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICBtZXNzYWdlOiAnUGFyY2VsIG5vdCBmb3VuZCcsXG4gIH0pO1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjtcbiJdfQ==